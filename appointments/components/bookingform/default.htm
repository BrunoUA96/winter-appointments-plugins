<div class="booking-container">
    <div class="booking-header mb-4">
        <h1>Marca sua consulta</h1>
        <p>Tem duas formas de marcar sua consulta:</p>
    </div>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs d-flex justify-content-center booking-tabs" id="bookingTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button
                class="nav-link active"
                id="presencial-tab"
                data-bs-toggle="tab"
                data-bs-target="#presencial"
                type="button"
                role="tab"
                aria-controls="presencial"
                aria-selected="true"
            >
                Consulta presencial
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button
                class="nav-link"
                id="online-tab"
                data-bs-toggle="tab"
                data-bs-target="#online"
                type="button"
                role="tab"
                aria-controls="online"
                aria-selected="false"
            >
                Consulta online
            </button>
        </li>
    </ul>
    <div class="tab-content booking-tabs-content" id="bookingTabsContent">
        <!-- Online Tab -->
        <div
            class="tab-pane fade"
            id="online"
            role="tabpanel"
            aria-labelledby="online-tab"
        >
            <div class="">
                <div class="">
                    <div class="booking-header">
                        <p>
                            Selecione o hor√°rio mais conveniente para sua
                            consulta
                        </p>
                    </div>
                    <form
                        data-request="onSaveBooking"
                        data-request-validate
                        data-request-success="handleSuccess"
                        data-request-error="handleError"
                        data-request-update="'@default': ''"
                        data-request-flash
                        data-request-data="{}"
                    >
                    <div class="booking-content">
                        <div class="booking-form-section">
                                <div class="form-section">
                                    <h3>Dados pessoais</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="patient_name"
                                                >Seu nome</label
                                            >
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="patient_name"
                                                name="patient_name"
                                                required
                                                aria-required="true"
                                                aria-describedby="patient_name-error"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="email">Email</label>
                                            <input
                                                type="email"
                                                class="form-control"
                                                id="email"
                                                name="email"
                                                required
                                                aria-required="true"
                                                aria-describedby="email-error"
                                            />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="phone">Telefone</label>
                                            <input
                                                type="tel"
                                                class="form-control"
                                                id="phone"
                                                name="phone"
                                                required
                                                aria-required="true"
                                                aria-describedby="phone-error"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="birth_date">Data de nascimento</label>
                                            <input
                                                type="date"
                                                class="form-control"
                                                id="birth_date"
                                                name="birth_date"
                                                required
                                                aria-required="true"
                                                aria-describedby="birth_date-error"
                                            />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="sns_number">N√∫mero de utente (SNS)</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="sns_number"
                                                name="sns_number"
                                                aria-describedby="sns_number-error"
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="nif">NIF</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="nif"
                                                name="nif"
                                                aria-describedby="nif-error"
                                            />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="health_insurance">Seguro de sa√∫de</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="health_insurance"
                                            name="health_insurance"
                                            aria-describedby="health_insurance-error"
                                        />
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>Informa√ß√µes adicionais</h3>
                                    <div class="form-group">
                                        <label for="consultation_reason"
                                            >Motivo da consulta</label
                                        >
                                        <textarea
                                            class="form-control"
                                            id="consultation_reason"
                                            name="consultation_reason"
                                            rows="3"
                                            placeholder="Descreva o motivo da sua consulta..."
                                            required
                                            aria-required="true"
                                            aria-describedby="consultation_reason-error consultation_reason-help"
                                            maxlength="1000"
                                        ></textarea>
                                        <small id="consultation_reason-help" class="form-text text-muted" style="display: block; margin-top: 6px; font-size: 0.85rem;">
                                            M√°ximo de 1000 caracteres
                                        </small>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="form-group">
                                        <div
                                            class="g-recaptcha"
                                            data-sitekey="{{ recaptcha_site_key }}"
                                        ></div>
                                        <div
                                            class="invalid-feedback"
                                            data-validate-error-for="g-recaptcha-response"
                                        ></div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button
                                        type="button"
                                        class="btn btn-pink btn-booking"
                                        id="confirmBtn"
                                        onclick="showConfirmationModal()"
                                        aria-label="Confirmar agendamento da consulta"
                                    >
                                        Confirmar agendamento
                                    </button>
                                </div>
                            
                            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
                            <div 
                                id="confirmationModal" 
                                class="modal"
                                role="dialog"
                                aria-labelledby="modal-title"
                                aria-modal="true"
                                aria-hidden="true"
                                tabindex="-1"
                            >
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h2 id="modal-title">Confirma√ß√£o de agendamento</h2>
                                        <button
                                            type="button"
                                            class="close"
                                            onclick="closeConfirmationModal()"
                                            aria-label="Fechar modal"
                                            tabindex="0"
                                        >&times;</button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="confirmation-preview">
                                            <div class="preview-section">
                                                <h3>Dados pessoais</h3>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Nome:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-name"
                                                    ></span>
                                                </div>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Email:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-email"
                                                    ></span>
                                                </div>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Telefone:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-phone"
                                                    ></span>
                                                </div>
                                            </div>

                                            <div class="preview-section">
                                                <h3>
                                                    Detalhes da consulta
                                                </h3>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Tipo de
                                                        consulta:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-consultation"
                                                    ></span>
                                                </div>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Data:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-date"
                                                    ></span>
                                                </div>
                                                <div class="preview-item">
                                                    <span
                                                        class="preview-label"
                                                        >Hora:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-time"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="preview-item"
                                                    id="preview-consultation-reason-container"
                                                >
                                                    <span
                                                        class="preview-label"
                                                        >Motivo da consulta:</span
                                                    >
                                                    <span
                                                        class="preview-value"
                                                        id="preview-consultation-reason"
                                                    ></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="confirmation-notice">
                                            <div class="notice-text">
                                                <strong>Importante:</strong>
                                                Por favor, certifique-se de
                                                que todos os dados est√£o
                                                corretos.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <form id="modal-form">
                                            <button
                                                type="button"
                                                class="btn btn-pink btn-booking"
                                                id="modal-submit-btn"
                                                onclick="submitBookingForm()"
                                                data-attach-loading
                                            >
                                                Confirmar agendamento
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="booking-info-section">
                            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –≤—ã–±–æ—Ä–æ–º —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –∏ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏ -->
                            <div class="info-card booking-selection-card">
                                <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
                                <input
                                    type="hidden"
                                    id="appointment_date"
                                    name="appointment_date"
                                    required
                                    aria-required="true"
                                />
                                <input
                                    type="hidden"
                                    id="appointment_time"
                                    name="appointment_time"
                                    required
                                    aria-required="true"
                                />
                                
                                <div class="info-header">
                                    <h3>Tipo de consulta</h3>
                                </div>
                                <div class="info-content">
                                    <div class="form-group">
                                        <select
                                            class="form-control consultation-select"
                                            id="consultation_type_id"
                                            name="consultation_type_id"
                                            required
                                            aria-required="true"
                                            aria-describedby="consultation_type_id-error"
                                        >
                                            <option value="">
                                                Selecione o tipo de consulta
                                            </option>
                                            {% for id, name in consultationTypes
                                            %}
                                            <option value="{{ id }}">
                                                {{ name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="info-header" style="margin-top: 24px;">
                                    <h3>Data e hora</h3>
                                </div>
                                <div class="info-content">
                                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                                    <div class="form-group calendar-group">
                                        <label>Selecione a data</label>
                                        <div id="calendar-container" class="calendar-container"></div>
                                    </div>
                                    
                                    <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã -->
                                    <div class="form-group time-slots-group">
                                        <label>Selecione o hor√°rio</label>
                                        <div id="time-slots-container" class="time-slots-container"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="info-card">
                                <div class="info-header">
                                    <h3>üìã Informa√ß√µes sobre o agendamento</h3>
                                </div>
                                <div class="info-content">
                                    <div class="info-item">
                                        <div class="info-text">
                                            <span
                                                >Apos a confirma√ß√£o do
                                                agendamento, voc√™ receber√° um
                                                e-mail de confirma√ß√£o junto com
                                                o link para a consulta.</span
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="info-card">
                                <div class="info-header">
                                    <h3>Informa√ß√£o da consulta</h3>
                                </div>
                                <div
                                    class="info-content"
                                    id="consultation-features"
                                >
                                    <div class="feature-item">
                                        <span class="feature-icon">‚úì</span>
                                        <span
                                            >Selecione um tipo de consulta para
                                            ver as informa√ß√µes da consulta
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                    
                    </form>
                </div>
            </div>
        </div>

        <!-- Presencial Tab -->
        <div
            class="tab-pane fade show active"
            id="presencial"
            role="tabpanel"
            aria-labelledby="presencial-tab"
        >
            <div class="">
                <div class="">
                    <div class="booking-header">
                        <p>
                            Para marcar uma consulta presencial, clique no link
                            abaixo:
                        </p>
                    </div>

                    <div class="info-card">
                        <a
                            href="{{ presencial_url }}"
                            target="_blank"
                            class="btn btn-primary pink-batton"
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #2196f3,
                                    #1976d2
                                );
                                border: none;
                                padding: 12px 30px;
                                font-weight: 600;
                            "
                        >
                            Agendar Consulta Presencial
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
