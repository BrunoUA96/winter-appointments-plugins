<div class="booking-container">
    <div class="booking-header">
        <h1>Marca sua consulta</h1>
        <p>Selecione o hor√°rio mais conveniente para sua consulta</p>
    </div>

    <div class="booking-content">
        <div class="booking-form-section">
            <form
                data-request="onSaveBooking"
                data-request-validate
                data-request-success="handleSuccess"
                data-request-error="handleError"
                data-request-update="'@default': ''"
                data-request-flash
                data-request-data="{}"
                >
                
                <div class="form-section">
                    <h3>Dados pessoais</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient_name">Seu nome</label>
                            <input type="text" class="form-control" id="patient_name" name="patient_name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Telefone</label>
                        <input type="tel" class="form-control" id="phone" name="phone" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Tipo de consulta</h3>
                    <div class="form-group">
                        <select class="form-control consultation-select" id="consultation_type_id" name="consultation_type_id" required>
                            <option value="">Selecione o tipo de consulta</option>
                            {% for id, name in consultationTypes %}
                                <option value="{{ id }}">{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Data e hora</h3>
                    <div class="date-time-row">
                        <div class="form-group">
                            <label for="appointment_date">Data da consulta</label>
                            <input type="date" class="form-control date-input" id="appointment_date" name="appointment_date" min="{{ 'now'|date('Y-m-d') }}" required>
                        </div>
                        <div class="form-group">
                            <label for="appointment_time">Hora da consulta</label>
                            <select class="form-control time-select" id="appointment_time" name="appointment_time" required>
                                <option value="">Selecione a hora</option>
                                {% for time in availableTimes %}
                                    <option value="{{ time|date('H:i') }}">{{ time|date('H:i') }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Informa√ß√µes adicionais</h3>
                    <div class="form-group">
                        <label for="description">Descri√ß√£o (opcional)</label>
                        <textarea class="form-control" id="description" name="description" rows="3" placeholder="Descreva seus sintomas ou motivos para a consulta..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-group">
                        <div class="g-recaptcha" data-sitekey="{{ recaptcha_site_key }}" data-callback="onRecaptchaSuccess"></div>
                        <div class="invalid-feedback" data-validate-error-for="g-recaptcha-response"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-pink btn-booking" id="confirmBtn" onclick="showConfirmationModal()">
                        <!-- <span class="btn-icon">üìÖ</span> -->
                        Confirmar agendamento
                    </button>
                </div>
                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div id="confirmationModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Confirma√ß√£o de agendamento</h2>
            <span class="close" onclick="closeConfirmationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="confirmation-preview">
                <div class="preview-section">
                    <h3>Dados pessoais</h3>
                    <div class="preview-item">
                        <span class="preview-label">Nome:</span>
                        <span class="preview-value" id="preview-name"></span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Email:</span>
                        <span class="preview-value" id="preview-email"></span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Telefone:</span>
                        <span class="preview-value" id="preview-phone"></span>
                    </div>
                </div>
                
                <div class="preview-section">
                    <h3>Detalhes da consulta</h3>
                    <div class="preview-item">
                        <span class="preview-label">Tipo de consulta:</span>
                        <span class="preview-value" id="preview-consultation"></span>
                    </div>
                    <div class="preview-item">
                            <span class="preview-label">Data:</span>
                        <span class="preview-value" id="preview-date"></span>
                    </div>
                    <div class="preview-item">
                        <span class="preview-label">Hora:</span>
                        <span class="preview-value" id="preview-time"></span>
                    </div>
                    <div class="preview-item" id="preview-description-container" style="display: none;">
                        <span class="preview-label">Descri√ß√£o:</span>
                        <span class="preview-value" id="preview-description"></span>
                    </div>
                </div>
            </div>
            
            <div class="confirmation-notice">
                <div class="notice-text">
                    <strong>Importante:</strong> 
                    Por favor, certifique-se de que todos os dados est√£o corretos.
                </div>
            </div>
        </div>
        <div class="modal-footer">
            {# <button type="button" class="btn btn-secondary" onclick="closeConfirmationModal()">
                Cancelar
            </button> #}
           <!-- <button type="button" class="btn btn-pink" onclick="submitForm()"> -->
           <button type="submit" class="btn btn-pink btn-booking" data-attach-loading>
                Confirmar agendamento
            </button>
        </div>
    </div>
</div>

            </form>
        </div>

        <div class="booking-info-section">
            <div class="info-card">
                <div class="info-header">
                    <h3>üìã Informa√ß√µes sobre o agendamento</h3>
                </div>
                <div class="info-content">
                    <div class="info-item">
                        <!-- <div class="info-icon">üìß</div> -->
                        <div class="info-text">
                            <span>Apos a confirma√ß√£o do agendamento, voc√™ receber√° um e-mail de confirma√ß√£o junto com o link para a consulta.</span>
                        </div>
                    </div>
                    <!-- <div class="info-item">
                        <div class="info-icon">üìÖ</div> 
                        <div class="info-text">
                            <span>Apos a confirma√ß√£o do agendamento, voc√™ receber√° um e-mail de confirma√ß√£o junto com o link para a consulta.</span>
                        </div>
                    </div> -->
                </div>
            </div>

            <div class="info-card">
                <div class="info-header">
                    <h3>Informa√ß√£o da consulta</h3>
                </div>
                <div class="info-content" id="consultation-features">
                    <div class="feature-item">
                        <span class="feature-icon">‚úì</span>
                        <span>Selecione um tipo de consulta para ver as informa√ß√µes da consulta</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<style>
.booking-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.booking-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px 0;
}

.booking-header h1 {
    font-size: 2.5rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 10px;
}

.booking-header p {
    font-size: 1.1rem;
    font-weight: 300;
    color: #6c757d;
    margin: 0;
}

.booking-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    align-items: start;
}

.booking-form-section {
    background: white;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.form-section {
    margin-bottom: 30px;
}

.form-section h3 {
    font-size: 1.2rem;
    font-weight: 500;
    color: #2c3e50;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-weight: 400;
    color: #495057;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.form-control {
    width: 100%;
    padding: 9px 16px;
    border: 2px solid #e9ecef;
    font-size: 0.8rem;
    transition: all 0.3s ease;
    background: #fff;
    border-radius: 0;
}

.form-control:focus {
    outline: none;
    border-color: #ffd3f3;
    box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.1);
}



.date-time-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.consultation-select,
.time-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
}

textarea.form-control {
    resize: vertical;
    min-height: 100px;
}

.btn-booking {
    width: 100%;
    padding: 16px 24px;
    font-size: 1.1rem;
    font-weight: 600;
    border: none;
    color: rgba(0, 0, 0, 0.65);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.btn-booking:hover {
    background-color: #ffd3f3;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(106, 90, 205, 0.3);
}

.btn-booking:active {
    transform: translateY(0);
}

.btn-icon {
    font-size: 1.2rem;
}

.booking-info-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.info-card {
    background: white;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.info-header h3 {
    font-size: 1rem;
    font-weight: 400;
    color: #2c3e50;
    margin-bottom: 20px;
    margin-top: 0;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 10px;
}

.info-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.info-content .feature-item span {
    font-weight: 300;
}

.info-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.info-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    margin-top: 2px;
}

.info-text {
    font-size: 0.90rem;
    color: #495057;
    line-height: 1.5;
}

.info-text span {
    font-weight: 300;
}

.info-text strong {
    color: #2c3e50;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.8rem;
    color: #495057;
}

.feature-icon {
    color: #28a745;
    font-weight: bold;
    font-size: 1.1rem;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease;
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideIn 0.3s ease;
    overflow: hidden;
    border-radius: 0px;
}

.modal-header {
    background: linear-gradient(135deg, #ffd3f3 0%, #ffd3f3 100%);
    color: white;
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    border-radius: 0px;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.65);
}

.close {
    color: white;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: opacity 0.3s ease;
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
}

.close:hover {
    opacity: 0.7;
}

.modal-body {
    padding: 30px;
}

.confirmation-preview {
    margin-bottom: 25px;
}

.preview-section {
    margin-bottom: 25px;
}

.preview-section h3 {
    font-size: 1rem;
    font-weight: 400;
    color: #2c3e50;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e9ecef;
}

.preview-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 4px 0;
    border-bottom: 1px solid #f8f9fa;
}

.preview-item:last-child {
    border-bottom: none;
}

.preview-label, .preview-value {
    font-size: 0.9rem;
    font-weight: 400;
    color: #6c757d;
    min-width: 120px;
    flex-shrink: 0;
}

.preview-value {
    text-align: right;
    word-break: break-word;
}

.confirmation-notice {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    padding: 15px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.notice-text {
    font-size: 1rem;
    font-weight: 400;
    color: #1565c0;
    line-height: 1.5;
}

.modal-footer {
    background: #f8f9fa;
    padding: 20px 30px;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    border-top: 1px solid #e9ecef;
}

.btn {
    border-radius: 0;
    padding: 12px 24px;
    border: none;
    font-weight: 400;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-pink {
    background-color: #ffd3f3 !important;
    -webkit-box-shadow: 0px 0px 20px 1px #ffd3f3 !important;
    -moz-box-shadow: 0px 0px 20px 1px #ffd3f3;
    box-shadow: 0px 0px 20px 1px #ffd3f3 !important;
}

.btn-pink:hover {
    transform: translateY(-2px);
}

.btn-pink:active {
    transform: translateY(0);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { 
        opacity: 0;
        transform: translateY(-50px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

/* reCAPTCHA styling */
.g-recaptcha {
    margin: 20px 0;
}

/* Responsive design */
@media (max-width: 768px) {
    .booking-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .form-row,
    .date-time-row {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .booking-header h1 {
        font-size: 2rem;
    }
    
    .booking-form-section {
        padding: 20px;
    }
    
    .info-card {
        padding: 20px;
    }
    
    .modal-content {
        width: 95%;
        margin: 10% auto;
    }
    
    .modal-header,
    .modal-body,
    .modal-footer {
        padding: 15px 20px;
    }
    
    .preview-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
    
    .preview-label {
        min-width: auto;
    }
    
    .preview-value {
        text-align: left;
    }
    
    .modal-footer {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
}

/* Loading state */
.btn-booking.loading {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Success/Error messages */
.alert {
    padding: 15px 20px;
    margin-bottom: 20px;
    font-weight: 500;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* Form validation styling */
.form-control.is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

.invalid-feedback {
    display: block;
    color: #dc3545;
    font-size: 0.875rem;
    margin-top: 5px;
}
</style>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<script>
console.log('Script loaded');

function onRecaptchaSuccess(token) {
    console.log('reCAPTCHA verified with token:', token);
}

function handleSuccess(response) {
    console.log('Form submitted successfully:', response);
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeConfirmationModal();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
    showMessage('Consulta agendada com sucesso. Em breve voc√™ receber√° um e-mail de confirma√ß√£o.', 'success');
    
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.querySelector('form').reset();
    // –û—á–∏—â–∞–µ–º reCAPTCHA
    grecaptcha.reset();
}

function handleError(response) {
    console.error('Form submission failed:', response);
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeConfirmationModal();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    showMessage('Ocorreu um erro ao criar a consulta. Por favor, tente novamente.', 'error');
    
    // –û—á–∏—â–∞–µ–º reCAPTCHA –ø—Ä–∏ –æ—à–∏–±–∫–µ
    grecaptcha.reset();
}

function showMessage(message, type) {
    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    const existingAlert = document.querySelector('.alert');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form');
    form.insertBefore(alert, form.firstChild);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (alert.parentNode) {
            alert.remove();
        }
    }, 5000);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
function combineDateTime(date, time) {
    if (!date || !time) return '';
    return `${date} ${time}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-PT', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
function getConsultationName(selectElement) {
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    return selectedOption ? selectedOption.text : '';
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
function showConfirmationModal() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form');
    //const form = this;
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º reCAPTCHA
    const recaptchaResponse = grecaptcha.getResponse();
    if (!recaptchaResponse) {
        showMessage('Por favor, confirme que voc√™ n√£o √© um rob√¥.', 'error');
        return;
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã–º–∏
    document.getElementById('preview-name').textContent = document.getElementById('patient_name').value;
    document.getElementById('preview-email').textContent = document.getElementById('email').value;
    document.getElementById('preview-phone').textContent = document.getElementById('phone').value;
    document.getElementById('preview-consultation').textContent = getConsultationName(document.getElementById('consultation_type_id'));
    document.getElementById('preview-date').textContent = formatDate(document.getElementById('appointment_date').value);
    document.getElementById('preview-time').textContent = document.getElementById('appointment_time').value;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
    const description = document.getElementById('description').value;
    const descriptionContainer = document.getElementById('preview-description-container');
    if (description.trim()) {
        document.getElementById('preview-description').textContent = description;
        descriptionContainer.style.display = 'flex';
    } else {
        descriptionContainer.style.display = 'none';
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    document.getElementById('confirmationModal').style.display = 'block';
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.body.style.overflow = 'hidden';
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function closeConfirmationModal() {
    document.getElementById('confirmationModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.querySelector('form').addEventListener('submit', function(e) {
    e.preventDefault();

    const date = document.getElementById('appointment_date').value;
    const time = document.getElementById('appointment_time').value;
    
    // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
    let hiddenField = document.getElementById('combined_appointment_time');
    if (!hiddenField) {
        hiddenField = document.createElement('input');
        hiddenField.type = 'hidden';
        hiddenField.id = 'combined_appointment_time';
        hiddenField.name = 'appointment_time';

       this.appendChild(hiddenField);
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
    hiddenField.value = combineDateTime(date, time);
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º AJAX –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    //const form = document.querySelector('form');
    const form = this;
    console.log(form);
    const formData = new FormData(form);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ formData
    formData.set('appointment_time', hiddenField.value);
    
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.log('Form data before submission:');
    for (let [key, value] of formData.entries()) {
        console.log(`${key}: ${value}`);
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
    $.request('onSaveBooking', {
        data: formData,
        success: function(response) {
            handleSuccess(response);
        },
        error: function(response) {
            handleError(response);
        }
    });
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
window.onclick = function(event) {
    const modal = document.getElementById('confirmationModal');
    if (event.target === modal) {
        closeConfirmationModal();
    }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeConfirmationModal();
    }
});

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
document.querySelectorAll('input, select, textarea').forEach(field => {
    field.addEventListener('change', function(e) {
        console.log(`Field ${this.name} changed to:`, this.value);
    });
});
 
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
document.getElementById('consultation_type_id').addEventListener('change', function() {
    updateConsultationFeatures(this.value);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è features –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
function updateConsultationFeatures(consultationTypeId) {
    const featuresContainer = document.getElementById('consultation-features');
    
    if (!consultationTypeId) {
        featuresContainer.innerHTML = `
            <div class="feature-item">
                <span class="feature-icon">‚úì</span>
                <span>Selecione um tipo de consulta para ver o que est√° inclu√≠do</span>
            </div>
        `;
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º features —á–µ—Ä–µ–∑ AJAX
    $.request('onGetConsultationFeatures', {
        data: { consultation_type_id: consultationTypeId },
        success: function(response) {
            if (response.features && response.features.length > 0) {
                let featuresHtml = '';
                response.features.forEach(feature => {
                    featuresHtml += `
                        <div class="feature-item">
                            <span class="feature-icon">‚úì</span>
                            <span>${feature}</span>
                        </div>
                    `;
                });
                featuresContainer.innerHTML = featuresHtml;
            } else {
                featuresContainer.innerHTML = `
                    <div class="feature-item">
                        <span class="feature-icon">‚ÑπÔ∏è</span>
                        <span>Nenhuma informa√ß√£o dispon√≠vel para este tipo de consulta</span>
                    </div>
                `;
            }
        },
        error: function() {
            featuresContainer.innerHTML = `
                <div class="feature-item">
                    <span class="feature-icon">‚ö†Ô∏è</span>
                    <span>Erro ao carregar informa√ß√µes da consulta</span>
                </div>
            `;
        }
    });
}
</script>